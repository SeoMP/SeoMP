<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>登录界面</title>
<script type="text/javascript" src="common/core.js"></script>
<link rel="shortcut icon" href="common/favicon.ico" type="image/x-icon" />
<style type="text/css">
	.panel-title{font-size:120%;}
</style>
</head>
<body>
	<div class="easyui-panel" title="用户登录" data-options="fit:true">	
        <form id="loginForm">
			<div class="div1">
				<div class="div11">用户名：</div>
				<div class="div12">
					<input id="userId" name="userId" class="easyui-textbox" prompt="请输入用户名" width="50px;" 
						data-options="required:true">
				</div>
			</div>
			<div class="div1">
				<div class="div11">密码：</div>
				<div class="div12">
					<input id="password"  name="password" class="easyui-textbox" type="password" prompt="请输入密码" width="50px;"
						data-options="required:true">
				</div>
			</div>
			<div class="div1">
				<div class="div11">验证码：</div>
				<div class="div12">
					<div class="div121">
						<input id="validCode" name="validCode" class="easyui-textbox"  prompt="请输入验证码" width="50px;"
							data-options="required:true">
					</div>
					<div class="div122">
						<img id="valiImage" style="vertical-align:middle;" alt="验证码" title="点击更新验证码" >
					</div>
				</div>
			</div>	
        </form>
		<div class="lonOrRegDiv">
            <a id="loginBtn" class="easyui-linkbutton" style="width:5%;background:rgba(2, 132, 195, 1);">
				<span class="lonOrRegSp">登录</span>
			</a>
        </div>
    </div>
    <div id="win" class="easyui-window" title="My Window" style="width:600px;height:400px"   
        data-options="iconCls:'icon-save',modal:true">   
	</div>  
	<script type="text/javascript">
		$(function(){
			/* 生成验证码 */
			var createValiCode = function(){
				var url = contextPath+"CreateVerifCode?timestamp="+new Date().getTime();
				$("#valiImage").attr("src",url);
			}
			$("#valiImage").click(createValiCode);
			createValiCode();
			/* 登录处理 */
			$("#loginBtn").bind('click',function(){
				var loginUrl = contextPath+"common/LoginInDeal.action?timestamp="+new Date().getTime();
				if($("#loginForm").form('validate')){
					var data = $("#loginForm").serializeObject();
					$.ajax({
						url:loginUrl,
						type:'POST',
						data:data,
						timeout:30000,
						success:function(){
							//登录成功，全屏设置
							if(window.name != 'MPFullIndex'){
								window.open(contextPath+"MPIndex.html",'MPFullIndex',
										'fullscreen=yes,location=no,menubar=no,titlebar=no,toolbar=no,resizable=no,status=no');
								window.close();
							}
						},
						error:function(xhr){
						  var responseText = xhr.responseText;
						  top.$.messager.alert('提示',responseText,"",function(){
							  setTimeout(createValiCode,1000);
						  });
						  /* if(!responseText){
							  top.$.messager.alert('提示',"平台异常！","",function(){
								  setTimeout(createValiCode,1000);
							  });
							  return;
						  } 
						  var ex = responseText.split("CommonException")[1];
						  var errorMsg = ex.substring(ex.indexOf("[")+1,ex.indexOf("]")); 
						  top.$.messager.alert('提示',errorMsg,"",function(){
							  setTimeout(createValiCode,1000);
						  }); */ 
						  /* var error = JSON.parse(responseText);
						  if(error.ECODE == "E001"){
							  top.$.messager.alert('提示',error.EMSG);
							  setTimeout(function(){
								  window.location.href = contextPath+"MPLogin.html";
							  },2000);
						  }
						   */
						},
						complete:function(){
							
						}
					});
				}
			});
		});
	</script> 
</body>
</html>